Nested Data (Вложенные данные)
Представим гипотетический датасет который содержит информацию о животных и их игрушках. Мы можем организовать эту информацию в 2 
разные таблицы( pets и toys ). toys может содержать столбец Pet_ID котороый используется чтобы связать игрушку с ее "владельцем".

pets table                             toys table
+====+==========+=====+========+      +====+==========+=======+========+
| ID |   Name   | Age | Animal |      | ID |   Name   | Type  | Pet_ID |
+----+----------+-----+--------+      +----+----------+-------+--------+
|  1 |   Moon   |  9  |   Dog  |      |  1 |   McFly  |Frisbee|    1   |
+----+----------+-----+--------+      +----+----------+-------+--------+
| 2  |   Ripley |  7  |   Cat  |      | 2  |  Fluffy  |Feather|    2   |
+----+----------+-----+--------+      +----+----------+-------+--------+
| 3  | Napoleon |  1  |  Fish  |      | 3  |   Eddy   | Castle|    3   |
+----+----------+-----+--------+      +----+----------+-------+--------+


pets_and_toys table
+====+==========+=====+========+=============================+
| ID |   Name   | Age | Animal | Toy                         |
+====+==========+=====+========+=============================+
| 1  |   Moon   |  9  |   Dog  |{Name: McFly, Type: Frisbee} |
+----+----------+-----+--------+-----------------------------+
| 2  |  Ripley  |  7  |   Cat  |{Name: Fluffy, Type: Feather}|
+----+----------+-----+--------+-----------------------------+ 
| 3  | Napoleon |  1  |  Fish  |{Name: Eddy, Type: Castle}   |
+----+----------+-----+--------+-----------------------------+ 


Другой опцией в BigQuery является организовать всю информацию в одну таблицу (pets_and_toys).
В данном случае вся информация из таблицы toys сжата в однин стобец Toy в таблице pets_and_toys. И такой столбец называется
столбец с Вложенными Данными.  Т.е. Данные Name и Type Вложены в него.
Вложенные данные имеют тип STRUCT (или RECORD).
Чтобы совершить запрос к Вложенным Данным, нам нужно определить каждое поле в контексте столбца который содержить его.
- Toy.Name - значение Name в столбце Toy
- ЕщнюЕнзу - значение Type в столбце Toy

query = """
        SELECT Name AS Pet_Name,
        Toy.Name AS Toy_Name,
        Toy.Type AS Toy_Type
        FROM `bigquery-public-data.pet_records.pets_and_toys`
        """


Repeated data (Повторяющиеся данные)
Теперь предположим более реалистичный случай, где каждый питомец имеет несколько игрушек. В данном случае мы сжимаем данные в 
массив и записываем его в один столбец

pets table                             toys table
+====+==========+=====+========+      +====+=======+========+
| ID |   Name   | Age | Animal |      | ID | Type  | Pet_ID |
+----+----------+-----+--------+      +----+-------+--------+
|  1 |   Moon   |  9  |   Dog  |      |  1 |Frisbee|    1   |
+----+----------+-----+--------+      +----+-------+--------+
| 2  |   Ripley |  7  |   Cat  |      |  2 | Bone  |    1   |
+----+----------+-----+--------+      +----+-------+--------+
| 3  | Napoleon |  1  |  Fish  |      |  3 | Rope  |    1   |
+----+----------+-----+--------+      +----+-------+--------+
                                      |  4 |Feather|    2   |
                                      +----+-------+--------+
                                      |  5 | Ball  |    2   |
                                      +----+-------+--------+
                                      |  6 | Castle|    3   |
                                      +----+-------+--------+


pets_and_toys_type table
+====+========+=====+======+=====================+
| ID |  Name  | Age |Animal| Toys                |
+====+========+=====+======+=====================+
| 1  |  Moon  |  9  | Dog  |[Frisbee, Bone, Rope]|
+----+--------+-----+------+---------------------+
| 2  | Ripley |  7  | Cat  |[Feather,Ball]       |
+----+--------+-----+------+---------------------+
| 3  |Napoleon|  1  | Fish |[Castle]             |
+----+--------+-----+------+---------------------+

Мы говорим что стобец Toys содержит Повторяющиеся данные, так как он содержит более одного значения в каждой строке.
Каждое вхождение в повторяющихся полях - ARRAY. 

Чтобы обратится к данным нам нужно поместить название столбца с повторяющимися данными внутрь UNNEST()

query = """
        SELECT Name AS Pet_Name,
            Toy_Type
        FROM `bigquery-public-data.pet_records.pets_and_toys_type`,
            UNNEST(Toys) AS Toy_Type
        """

Вложенные повторяющиеся данные
Совмещает в себе предидущие свойства

pets table                             more_toys table
+====+==========+=====+========+      +====+=========+=======+========+
| ID |   Name   | Age | Animal |      | ID |   Name  | Type  | Pet_ID |
+----+----------+-----+--------+      +----+---------+-------+--------+
|  1 |   Moon   |  9  |   Dog  |      |  1 |  McFly  |Frisbee|    1   |
+----+----------+-----+--------+      +----+---------+-------+--------+
| 2  |   Ripley |  7  |   Cat  |      |  2 |  Scully | Bone  |    1   |
+----+----------+-----+--------+      +----+---------+-------+--------+
| 3  | Napoleon |  1  |  Fish  |      |  3 | Pusheen | Rope  |    1   |
+----+----------+-----+--------+      +----+---------+-------+--------+
                                      |  4 |  Fluffy |Feather|    2   |
                                      +----+---------+-------+--------+
                                      |  5 | Robert  | Ball  |    2   |
                                      +----+---------+-------+--------+
                                      |  6 |   Eddy  | Castle|    3   |
                                      +----+---------+-------+--------+


pets_and_toys_type table
+====+========+=====+======+===============================+
| ID |  Name  | Age |Animal| Toys                          |
+====+========+=====+======+===============================+
| 1  |  Moon  |  9  | Dog  |[{Name: McFly, Type: Frisbee}, |
|    |        |     |      |{Name: Scully, Type: Bone},    |
|    |        |     |      |{Name: Pusheen, Type: Rope}]   |
+----+--------+-----+------+-------------------------------+
| 2  | Ripley |  7  | Cat  |[{Name: Fluffy, Type: Feather},|
|    |        |     |      |{Name: Robert, Type: Ball}]    |
+----+--------+-----+------+-------------------------------+
| 3  |Napoleon|  1  | Fish |[{Name: Eddy, Type: Castle}]   |
+----+--------+-----+------+-------------------------------+

query = """
        SELECT Name AS Pet_Name,
        t.Name AS Toy_Name,
        t.Type AS Toy_Type
        FROM `bigquery-public-data.pet_records.pets_and_toys_type`,
            UNNEST(Toys) AS t
        """